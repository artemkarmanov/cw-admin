<cwb-page-top>
    <cwb-button-header>
        <h1>Bookings</h1>
        <button (click)="reload()" class="btn btn-sm text-primary">
            <cwb-icon name="arrow-clockwise"></cwb-icon>
        </button>

    </cwb-button-header>
    <cwb-create-button></cwb-create-button>
</cwb-page-top>


<cwb-card>
    <table>
        <thead>
        <tr class="table-light">
            <th>Booking ID</th>
            <th>Title</th>
            <th>Next session</th>
            <th>Duration</th>
            <th>Remaining</th>
            <th>Total</th>
        </tr>
        </thead>
        <ng-container *ngIf="bookings$ | async as bookings">
            <tbody *ngIf="bookings.length;else empty">
            <tr *ngFor="let booking of bookings" style="line-height: 0px;">
                <td><a [routerLink]="booking.bookingToken">{{booking.bookingToken}}</a></td>
                <td>{{booking.title}}</td>
                <!-- I had to add this 'getAdjustedHour()' function because the backend is now (as of March 23, 2022)-->
                <!-- returning date startEpochs with fewer digits than before -->
                <!-- All bookings created from here on will display correctly now, but some past  -->
                <!-- bookings will not display correctly anymore -->
                                               
                <td>{{getAdjustedHour(booking.nextSessionStartEpoch, booking.bookingTimeZone) | date: 'short':'+0000'}}</td>
                <td>{{booking.nextSessionDurationMins}}</td>
                <td>{{booking.totalSessions}}</td>
                <td>{{booking.countFutureSessions}}</td>
            </tr>
            </tbody>
        </ng-container>
    </table>
    <ng-template #empty>
        <tr>
            <td class="text-center" colspan="5" style="padding:48px;">
                <div>
                    You have no bookings yet. Click on "Add new booking" to make your first booking.
                </div>
                <a class="link-primary" routerLink="create">Add new booking</a>
            </td>
        </tr>
    </ng-template>
</cwb-card>
