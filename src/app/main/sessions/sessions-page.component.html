<cwb-page-top>
    <cwb-button-header>
        <h1>Sessions</h1>
        <button (click)="reload()" class="btn btn-sm text-primary">
            <cwb-icon name="arrow-clockwise"></cwb-icon>
        </button>
    </cwb-button-header>
</cwb-page-top>

<cwb-card>
    <cwb-filter></cwb-filter>
    <table>
        <thead>
        <tr class="table-light">
            <th>Session ID</th>
            <th>Title</th>
            <th>Session start</th>
            <th>Duration</th>
            <th>Status</th>
            <th>Owner</th>
            <th>&nbsp;</th>
        </tr>
        </thead>
        <ng-container *ngIf="sessions$ | async as sessions">
            <tbody *ngIf="sessions.length;else empty">
                <tr *ngFor="let session of sessions">
                    <ng-container *ngIf="isNotCancelled(session)">
                        <td>{{session.sessionId}}</td>
                        <td><a [routerLink]="'/bookings/'+session.bookingToken">{{session.title}}</a></td>
                        <!-- I had to add this 'getAdjustedHour()' function because the backend is now (as of March 23, 2022)-->
                        <!-- returning date startEpochs with fewer digits than before -->
                        <!-- All bookings created from here on will display correctly now, but some past  -->
                        <!-- bookings will not display correctly anymore -->
                        <td>{{getAdjustedHour(session.startEpoch, session.bookingTimeZone) | date: 'd MMM YYYY hh:mm a':'+0000'}}</td>
                        <td>{{session.sessionDurationMins}}</td>
                        <td><span cwbStatus>{{session.status}}</span></td>
                        <td>{{session | owner}}</td>
                        <td>
                            <ng-container *ngIf="isEditable(session)">
                                <button (click)="edit(session)" class="btn">
                                    <cwb-icon name="pencil"></cwb-icon>
                                </button>
                                <button (click)="cancel(session.sessionId)" class="btn">
                                    <cwb-icon name="x-lg"></cwb-icon>
                                </button>
                            </ng-container>
                        </td>
                    </ng-container>
                </tr>
            </tbody>
        </ng-container>
    </table>
    <ng-template #empty>
        <tr>
            <td class="text-center" colspan="6" style="padding:48px;">
                <div>
                    There are not any sessions
                </div>

            </td>
        </tr>
    </ng-template>
</cwb-card>
